# Micro Service Architecture

## Spring Cloud Config
- 중앙 집중식 마이크로서비스 구성을 지원
- 두 가지 구성 요성
    - Spring Cloud Config Server
        - 버전 관리 리포지토리로 백업 된 중앙 집중 구성 노출을 지원
    - Spring Cloud Config Client
        - Spring Cloud Config Server 연결을 지원


## Spring Cloud Bus
- 프로덕션 환경에서 실행중인 마이크로서비스 A의 인스턴스가 N개가 있을 경우에는 설정을 변경하기 위해서 N대의 인스턴스 서버에 N번의 refresh API를 호출하는 이슈 존재
- 이를 해결하기 위해 Spring Cloud Bus를 이용해 변경 전파

### Spring Cloud Bus 적용 방법
- Rabbit MQ와 같은 브로커를 통해서 변경 사항을 여러 인스턴스에 전달
- 각각의 마이크로서비스 인스턴스들은 구동 시에 스프링 클라우드 버스에 등록되고, 클라우드 버스의 이벤트를 수신
- 마이크로서비스 인스턴스 중 하나에 refresh가 호출되면 스프링 클라우드 버스는 모든 마이크로서비스 인스턴스에 변경 이벤트를 전달


## API 게이트웨이
### API 게이트웨이에서 제공하는 기능
- 인증 및 보안
- 동적 라우팅 및 정적 응답 처리
- 속도 제한
- 로드 차단
- 모니터링
- 여러 가지 서비스의 응답 집계

### Zuul
- 동적 라우팅, 필터링, 보안, 모니터링 등의 기능을 제공하는 API 게이트웨이

### Zuul 필터
#### 사전 필터
- zuul에서 목표 대상에 대한 실제 요청이 발생되기 전에 호출
- 사전 필터의 역할
    - 서비스의 일관된 메세지 형식(HTTP 헤더의 포함 여부)을 확인하는 작업을 수행
    - 서비스를 이용하는 사용자가 인증 및 인가되었는지를 확인하는 작업을 수행

#### 사후 필터
- 대상 서비스를 호출하고 응답을 클라이언트에게 전송한 후 호출
- 사후 필터의 역할
    - 서비스의 응답을 로깅하거나 에러 처리

#### 경로 필터
- 대상 서비스를 호출하기 전에 가로채는데 사용
- 경로 필터의 역할
    - 일정 수준의 동적 라우팅 필요 여부를 결정하는데 사용
    
    
## Eureka
### Eureka 네임 서버
- 서비스의 등록 및 서비스 검색 기능을 제공
- 네임 서버는 마이크로서비스들이 자신을 등록하고, 상호 작용하고자 하는 다른 마이크로서비스에 대한 URL을 찾을 수 있도록 도와준다.

### Eureka 네임 서버 동작
- 모든 마이크로서비스는 각 마이크로서비스가 시작될 때 네임 서버에 등록
- 서비스 소비자가 특정 마이크로서비스의 위치를 얻으려면 네임 서버에 요청
- 고유한 마이크로서비스 ID가 각각의 마이크로서비스에 지정
    - 등록 요청 및 검색 요청에서 키로 사용
- 마이크로서비스는 자동으로 등록 및 취소 할 수 있다.
- 서비스 소비자가 특정 마이크로서비스 ID로 네임 서버에 요청할 때마다 해당 특정 마이크로서비스의 인스턴스 목록을 가져온다.


## Ribbon
### 로드 밸런싱
- 마이크로서비스 인스턴스는 특정 마이크로서비스의 로드에 따라 확대 및 축소
- 부하가 마이크로서비스의 다른 인스턴스 간에 똑같이 분배되게 하기 위해서는 로드 밸런싱이 필요

### Ribbon 구성
- Ribbon은 마이크로서비스의 다른 인스턴스 간에 라운드 로빈 방식으로 클라이언트 사이드 로드 밸런싱을 제공